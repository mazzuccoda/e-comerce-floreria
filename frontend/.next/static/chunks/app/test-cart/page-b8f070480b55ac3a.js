(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7660],{9866:function(e,t,r){Promise.resolve().then(r.bind(r,946))},946:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var o=r(7437),s=r(2265),a=r(4523);function n(){let{cart:e,loading:t,error:r}=(0,a.u)();return(0,s.useEffect)(()=>{var o;console.log("=== TEST CART PAGE ==="),console.log("Cart:",e),console.log("Loading:",t),console.log("Error:",r),console.log("Items count:",null==e?void 0:null===(o=e.items)||void 0===o?void 0:o.length),console.log("Total items:",null==e?void 0:e.total_items),console.log("======================")},[e,t,r]),(0,o.jsxs)("div",{className:"max-w-4xl mx-auto p-8",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"\uD83E\uDDEA Test de Carrito"}),(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Estado del Carrito"}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Loading:"})," ",t?"✅ S\xed":"❌ No"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Error:"})," ",r||"✅ Ninguno"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Total Items:"})," ",(null==e?void 0:e.total_items)||0]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Total Price:"})," $",(null==e?void 0:e.total_price)||0]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Is Empty:"})," ",(null==e?void 0:e.is_empty)?"✅ S\xed":"❌ No"]})]})]}),(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Productos en el Carrito"}),(null==e?void 0:e.items)&&e.items.length>0?(0,o.jsx)("div",{className:"space-y-4",children:e.items.map((e,t)=>{var r;return(0,o.jsxs)("div",{className:"border-b pb-4",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Producto:"})," ",(null===(r=e.producto)||void 0===r?void 0:r.nombre)||"Sin nombre"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Cantidad:"})," ",e.quantity]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Precio:"})," $",e.price]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Total:"})," $",e.total_price]})]},t)})}):(0,o.jsx)("p",{className:"text-gray-500",children:"No hay productos en el carrito"})]}),(0,o.jsxs)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,o.jsx)("h3",{className:"font-semibold mb-2",children:"\uD83D\uDCCB Instrucciones:"}),(0,o.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-sm",children:[(0,o.jsx)("li",{children:"Ve a la p\xe1gina principal"}),(0,o.jsx)("li",{children:"Agrega productos al carrito"}),(0,o.jsx)("li",{children:"Vuelve a esta p\xe1gina"}),(0,o.jsx)("li",{children:"Verifica que los productos aparezcan aqu\xed"})]})]}),(0,o.jsx)("div",{className:"mt-6",children:(0,o.jsx)("pre",{className:"bg-gray-100 p-4 rounded text-xs overflow-auto",children:JSON.stringify(e,null,2)})})]})}},4523:function(e,t,r){"use strict";r.d(t,{CartProviderRobust:function(){return l},u:function(){return u}});var o=r(7437),s=r(2265),a=r(9064);let n={baseUrl:r(257).env.NEXT_PUBLIC_API_URL||"https://e-comerce-floreria-production.up.railway.app/api",timeout:1e4,retryAttempts:3,retryDelay:1e3};class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}async delay(e){return new Promise(t=>setTimeout(t,e))}generateRequestKey(e,t){return"".concat(e,"-").concat(JSON.stringify(t))}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;if(r.startsWith("http://")||r.startsWith("https://"));else if(r.startsWith("/api/"))r="".concat(n.baseUrl).concat(r.replace("/api",""));else{let e=r.replace(/^\/+/,"");r="".concat(n.baseUrl,"/").concat(e)}let o=r,s=this.generateRequestKey(o,t);if(this.requestQueue.has(s))return console.log("\uD83D\uDD04 Reusing existing request for ".concat(e)),this.requestQueue.get(s);let a=this.executeRequest(o,t);this.requestQueue.set(s,a);try{return await a}finally{this.requestQueue.delete(s)}}async executeRequest(e,t){let r;for(let o=1;o<=n.retryAttempts;o++){let s=new AbortController,a=setTimeout(()=>{console.log("⏰ Request timeout after ".concat(n.timeout,"ms")),s.abort()},n.timeout);try{console.log("\uD83C\uDF10 API Request (attempt ".concat(o,"): ").concat(e));let r=(t.method||"GET").toUpperCase(),n={Accept:"application/json"};"GET"===r||t.headers&&"Content-Type"in t.headers||(n["Content-Type"]="application/json");let i={...t,method:r,signal:s.signal,credentials:"include",headers:{...n,...t.headers||{}}},c=await fetch(e,i);if(clearTimeout(a),console.log("\uD83D\uDCE1 Response received: ".concat(c.status," ").concat(c.statusText)),!c.ok){let e="HTTP error! status: ".concat(c.status),t=c.clone();try{let t=await c.json();t&&"object"==typeof t&&(e=t.message||t.error||JSON.stringify(t))}catch(r){try{let r=await t.text();r&&(e=r)}catch(e){}}let r=Error(e);throw r.status=c.status,r}try{let t=await c.json();return console.log("✅ API Success: ".concat(e),t),t}catch(e){throw console.error("❌ Error parsing JSON response:",e),Error("Invalid JSON response from server")}}catch(t){if(r=t,console.error("❌ API Error (attempt ".concat(o,"): ").concat(e),t.message),("AbortError"===t.name||t.message.includes("fetch"))&&console.log("\uD83D\uDD04 Network/timeout error, will retry..."),o<n.retryAttempts){let e=n.retryDelay*o;console.log("⏳ Retrying in ".concat(e,"ms...")),await this.delay(e)}}}throw r||Error("All retry attempts failed")}constructor(){this.requestQueue=new Map}}let c=(0,s.createContext)(void 0),l=e=>{let{children:t}=e,r=()=>{try{let e=localStorage.getItem("cart_data");if(e){let t=JSON.parse(e);return console.log("✅ Carrito cargado desde localStorage:",t),t}}catch(e){console.error("❌ Error cargando carrito:",e)}return{items:[],total_price:0,total_items:0,is_empty:!0}},[n,l]=(0,s.useState)(()=>r()),[u,d]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null),p=(0,s.useRef)(i.getInstance()),g=(0,s.useRef)(!0);(0,s.useRef)(0);let f=(0,s.useRef)(!1),y=(0,s.useCallback)(e=>{if(g.current){console.log("\uD83D\uDD04 Updating cart state:",e),l(e),h(null);try{localStorage.setItem("cart_data",JSON.stringify(e)),sessionStorage.setItem("cart_data",JSON.stringify(e)),console.log("\uD83D\uDCBE Carrito guardado en localStorage y sessionStorage")}catch(e){console.error("❌ Error guardando carrito:",e)}}},[]),v=(0,s.useCallback)(e=>{g.current&&d(e)},[]),x=(0,s.useCallback)(e=>{g.current&&h(e)},[]),D=(0,s.useCallback)(async()=>{if(f.current){console.log("\uD83D\uDD04 RefreshCart already in progress, skipping...");return}f.current=!0;try{v(!0),x(null),console.log("\uD83D\uDD04 Starting robust cart refresh...");let e=Date.now(),t=await p.current.request("/carrito/simple/?t=".concat(e),{method:"GET"});if(t&&"object"==typeof t){let e={items:Array.isArray(t.items)?t.items:[],total_price:parseFloat(t.total_price)||0,total_items:parseInt(t.total_items)||0,is_empty:!!t.is_empty};y(e),console.log("✅ Cart refreshed successfully:",e)}else throw Error("Invalid data structure received from server")}catch(e){console.error("❌ Cart refresh failed:",e),x("Connection failed: ".concat(e.message)),y({items:[],total_price:0,total_items:0,is_empty:!0})}finally{v(!1),f.current=!1}},[y,v,x]),b=(0,s.useCallback)(async()=>{console.log("\uD83D\uDD04 Retrying connection..."),await D()},[D]),E=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{v(!0),console.log("\uD83D\uDED2 Adding to cart:",{product:e.nombre,quantity:t});let r=await p.current.request("/carrito/simple/add/",{method:"POST",body:JSON.stringify({product_id:e.id,quantity:t})});(null==r?void 0:r.cart)?(y(r.cart),a.ZP.success("".concat(e.nombre," agregado al carrito"))):await D()}catch(e){console.error("❌ Add to cart failed:",e),a.ZP.error(e.message||"Error al agregar producto"),x(e.message)}finally{v(!1)}},[D,y,v,x]),j=(0,s.useCallback)(async e=>{try{v(!0),console.log("\uD83D\uDDD1️ Removing from cart:",e),await p.current.request("/carrito/remove/",{method:"DELETE",body:JSON.stringify({product_id:e})}),await D(),a.ZP.success("Producto eliminado del carrito")}catch(e){console.error("❌ Remove from cart failed:",e),a.ZP.error(e.message||"Error al eliminar producto"),x(e.message)}finally{v(!1)}},[D,v,x]),w=(0,s.useCallback)(async(e,t)=>{try{v(!0),console.log("\uD83D\uDCDD Updating quantity:",{productId:e,newQuantity:t}),await p.current.request("/carrito/update/",{method:"PUT",body:JSON.stringify({product_id:e,quantity:t})}),await D(),a.ZP.success("Cantidad actualizada")}catch(e){console.error("❌ Update quantity failed:",e),a.ZP.error(e.message||"Error al actualizar cantidad"),x(e.message)}finally{v(!1)}},[D,v,x]),C=(0,s.useCallback)(async()=>{try{v(!0),console.log("\uD83E\uDDF9 Clearing cart..."),await p.current.request("/carrito/clear/",{method:"DELETE"}),y({items:[],total_price:0,total_items:0,is_empty:!0}),a.ZP.success("Carrito limpiado")}catch(e){console.error("❌ Clear cart failed:",e),a.ZP.error(e.message||"Error al limpiar carrito"),x(e.message)}finally{v(!1)}},[y,v,x]);return(0,s.useEffect)(()=>(console.log("\uD83D\uDE80 CartProviderRobust mounted, starting initial load..."),D(),()=>{g.current=!1}),[]),(0,o.jsx)(c.Provider,{value:{cart:n,loading:u,error:m,addToCart:E,removeFromCart:j,updateQuantity:w,clearCart:C,refreshCart:D,retryConnection:b},children:t})},u=()=>{let e=(0,s.useContext)(c);if(void 0===e)throw Error("useCartRobust must be used within a CartProviderRobust");return e}},257:function(e,t,r){"use strict";var o,s;e.exports=(null==(o=r.g.process)?void 0:o.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,o,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:n}catch(e){r=n}}();var c=[],l=!1,u=-1;function d(){l&&o&&(l=!1,o.length?c=o.concat(c):u=-1,c.length&&m())}function m(){if(!l){var e=i(d);l=!0;for(var t=c.length;t;){for(o=c,c=[];++u<t;)o&&o[u].run();u=-1,t=c.length}o=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===n||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||l||i(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function o(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}},n=!0;try{t[e](a,a.exports,o),n=!1}finally{n&&delete r[e]}return a.exports}o.ab="//";var s=o(229);e.exports=s}()}},function(e){e.O(0,[9064,2971,2117,1744],function(){return e(e.s=9866)}),_N_E=e.O()}]);