(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4550],{2575:function(e,r,t){Promise.resolve().then(t.bind(t,6923))},6923:function(e,r,t){"use strict";t.r(r);var o=t(7437),n=t(2265),i=t(575),a=t(9376);r.default=()=>{var e,r,t,s,l;let{user:c,updateProfile:d,loading:u,isAuthenticated:m}=(0,i.a)(),f=(0,a.useRouter)(),[g,h]=(0,n.useState)(!1),[p,b]=(0,n.useState)({first_name:(null==c?void 0:c.first_name)||"",last_name:(null==c?void 0:c.last_name)||"",email:(null==c?void 0:c.email)||"",telefono:(null==c?void 0:null===(e=c.perfil)||void 0===e?void 0:e.telefono)||"",direccion:(null==c?void 0:null===(r=c.perfil)||void 0===r?void 0:r.direccion)||"",ciudad:(null==c?void 0:null===(t=c.perfil)||void 0===t?void 0:t.ciudad)||"",codigo_postal:(null==c?void 0:null===(s=c.perfil)||void 0===s?void 0:s.codigo_postal)||"",recibir_ofertas:(null==c?void 0:null===(l=c.perfil)||void 0===l?void 0:l.recibir_ofertas)||!1}),[x,v]=(0,n.useState)({});if(n.useEffect(()=>{u||m||f.push("/")},[m,u,f]),n.useEffect(()=>{if(c){var e,r,t,o,n;b({first_name:c.first_name||"",last_name:c.last_name||"",email:c.email||"",telefono:(null===(e=c.perfil)||void 0===e?void 0:e.telefono)||"",direccion:(null===(r=c.perfil)||void 0===r?void 0:r.direccion)||"",ciudad:(null===(t=c.perfil)||void 0===t?void 0:t.ciudad)||"",codigo_postal:(null===(o=c.perfil)||void 0===o?void 0:o.codigo_postal)||"",recibir_ofertas:(null===(n=c.perfil)||void 0===n?void 0:n.recibir_ofertas)||!1})}},[c]),u)return(0,o.jsx)("div",{className:"flex justify-center items-center min-h-[400px]",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-700"})});if(!m||!c)return null;let y=e=>{let{name:r,value:t,type:o,checked:n}=e.target;b(e=>({...e,[r]:"checkbox"===o?n:t})),x[r]&&v(e=>({...e,[r]:""}))},_=()=>{let e={};return p.first_name.trim()||(e.first_name="El nombre es requerido"),p.last_name.trim()||(e.last_name="El apellido es requerido"),p.email.trim()?/\S+@\S+\.\S+/.test(p.email)||(e.email="El email no es v\xe1lido"):e.email="El email es requerido",v(e),0===Object.keys(e).length},j=async e=>{e.preventDefault(),_()&&await d(p)&&h(!1)};return(0,o.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,o.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Mi Perfil"}),!g&&(0,o.jsx)("button",{onClick:()=>h(!0),className:"bg-green-700 text-white px-4 py-2 rounded-md hover:bg-green-800 transition-colors",children:"Editar Perfil"})]}),(0,o.jsxs)("form",{onSubmit:j,children:[(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),(0,o.jsx)("input",{type:"text",id:"first_name",name:"first_name",value:p.first_name,onChange:y,disabled:!g,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-green-600 ".concat(g?"":"bg-gray-50"," ").concat(x.first_name?"border-red-500":"border-gray-300")}),x.first_name&&(0,o.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.first_name})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellido"}),(0,o.jsx)("input",{type:"text",id:"last_name",name:"last_name",value:p.last_name,onChange:y,disabled:!g,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-green-600 ".concat(g?"":"bg-gray-50"," ").concat(x.last_name?"border-red-500":"border-gray-300")}),x.last_name&&(0,o.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.last_name})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,o.jsx)("input",{type:"email",id:"email",name:"email",value:p.email,onChange:y,disabled:!g,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-green-600 ".concat(g?"":"bg-gray-50"," ").concat(x.email?"border-red-500":"border-gray-300")}),x.email&&(0,o.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.email})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"telefono",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,o.jsx)("input",{type:"tel",id:"telefono",name:"telefono",value:p.telefono,onChange:y,disabled:!g,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-green-600 ".concat(g?"border-gray-300":"bg-gray-50")})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"direccion",className:"block text-sm font-medium text-gray-700 mb-1",children:"Direcci\xf3n"}),(0,o.jsx)("input",{type:"text",id:"direccion",name:"direccion",value:p.direccion,onChange:y,disabled:!g,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-green-600 ".concat(g?"border-gray-300":"bg-gray-50")})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"ciudad",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ciudad"}),(0,o.jsx)("input",{type:"text",id:"ciudad",name:"ciudad",value:p.ciudad,onChange:y,disabled:!g,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-green-600 ".concat(g?"border-gray-300":"bg-gray-50")})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"codigo_postal",className:"block text-sm font-medium text-gray-700 mb-1",children:"C\xf3digo Postal"}),(0,o.jsx)("input",{type:"text",id:"codigo_postal",name:"codigo_postal",value:p.codigo_postal,onChange:y,disabled:!g,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-green-600 ".concat(g?"border-gray-300":"bg-gray-50")})]})]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("input",{type:"checkbox",id:"recibir_ofertas",name:"recibir_ofertas",checked:p.recibir_ofertas,onChange:y,disabled:!g,className:"h-4 w-4 text-green-700 focus:ring-green-600 border-gray-300 rounded"}),(0,o.jsx)("label",{htmlFor:"recibir_ofertas",className:"ml-2 block text-sm text-gray-700",children:"Recibir ofertas y novedades por email"})]}),(0,o.jsxs)("div",{className:"border-t pt-4 mt-6",children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Informaci\xf3n de Cuenta"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Usuario"}),(0,o.jsx)("input",{type:"text",value:c.username,disabled:!0,title:"Nombre de usuario",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Miembro desde"}),(0,o.jsx)("input",{type:"text",value:new Date(c.date_joined).toLocaleDateString("es-AR"),disabled:!0,title:"Fecha de registro",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50"})]})]})]})]}),g&&(0,o.jsxs)("div",{className:"flex justify-end space-x-3 mt-6 pt-4 border-t",children:[(0,o.jsx)("button",{type:"button",onClick:()=>{var e,r,t,o,n;b({first_name:c.first_name||"",last_name:c.last_name||"",email:c.email||"",telefono:(null===(e=c.perfil)||void 0===e?void 0:e.telefono)||"",direccion:(null===(r=c.perfil)||void 0===r?void 0:r.direccion)||"",ciudad:(null===(t=c.perfil)||void 0===t?void 0:t.ciudad)||"",codigo_postal:(null===(o=c.perfil)||void 0===o?void 0:o.codigo_postal)||"",recibir_ofertas:(null===(n=c.perfil)||void 0===n?void 0:n.recibir_ofertas)||!1}),v({}),h(!1)},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,o.jsx)("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-green-700 text-white rounded-md hover:bg-green-800 disabled:opacity-50 transition-colors",children:u?"Guardando...":"Guardar Cambios"})]})]})]})})}},575:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return c},a:function(){return l}});var o=t(7437),n=t(2265),i=t(9064),a=t(257);let s=(0,n.createContext)(void 0),l=()=>{let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},c=e=>{let{children:r}=e,[t,l]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(!0),f=()=>a.env.NEXT_PUBLIC_API_URL||"https://e-comerce-floreria-production.up.railway.app/api",g=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=f(),o=await fetch("".concat(t).concat(e),{credentials:"include",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json",...c&&{Authorization:"Token ".concat(c)},...r.headers},...r});if(!o.ok)throw Error((await o.json().catch(()=>({}))).error||"HTTP error! status: ".concat(o.status));return o.json()};(0,n.useEffect)(()=>{let e=localStorage.getItem("auth_token"),r=localStorage.getItem("auth_user");e&&r&&(d(e),l(JSON.parse(r))),m(!1)},[]);let h=async(e,r)=>{try{m(!0);let t=await g("/usuarios/simple/login/",{method:"POST",body:JSON.stringify({username:e,password:r})});return l(t.user),d(t.token),localStorage.setItem("auth_token",t.token),localStorage.setItem("auth_user",JSON.stringify(t.user)),i.Am.success("\xa1Bienvenido, ".concat(t.user.first_name||t.user.username,"!")),!0}catch(r){let e=r instanceof Error?r.message:"Error desconocido";return i.Am.error("Error al iniciar sesi\xf3n: ".concat(e)),!1}finally{m(!1)}},p=async e=>{try{m(!0);let r=await g("/usuarios/simple/registro/",{method:"POST",body:JSON.stringify(e)});return l(r.user),d(r.token),localStorage.setItem("auth_token",r.token),localStorage.setItem("auth_user",JSON.stringify(r.user)),i.Am.success("\xa1Cuenta creada exitosamente! Bienvenido, ".concat(r.user.first_name||r.user.username,"!")),!0}catch(r){let e=r instanceof Error?r.message:"Error desconocido";return i.Am.error("Error al registrarse: ".concat(e)),!1}finally{m(!1)}},b=async()=>{try{c&&await g("/usuarios/simple/logout/",{method:"POST"})}catch(e){console.error("Error al hacer logout:",e)}finally{l(null),d(null),localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),i.Am.success("Sesi\xf3n cerrada exitosamente")}},x=async e=>{try{m(!0);let r=await g("/usuarios/simple/perfil/",{method:"PUT",body:JSON.stringify(e)});return l(r.user),localStorage.setItem("auth_user",JSON.stringify(r.user)),i.Am.success("Perfil actualizado exitosamente"),!0}catch(r){let e=r instanceof Error?r.message:"Error desconocido";return i.Am.error("Error al actualizar perfil: ".concat(e)),!1}finally{m(!1)}};return(0,o.jsx)(s.Provider,{value:{user:t,token:c,loading:u,login:h,register:p,logout:b,updateProfile:x,isAuthenticated:!!t&&!!c},children:r})}},9376:function(e,r,t){"use strict";var o=t(5475);t.o(o,"useParams")&&t.d(r,{useParams:function(){return o.useParams}}),t.o(o,"useRouter")&&t.d(r,{useRouter:function(){return o.useRouter}}),t.o(o,"useSearchParams")&&t.d(r,{useSearchParams:function(){return o.useSearchParams}})},257:function(e,r,t){"use strict";var o,n;e.exports=(null==(o=t.g.process)?void 0:o.env)&&"object"==typeof(null==(n=t.g.process)?void 0:n.env)?t.g.process:t(4227)},4227:function(e){!function(){var r={229:function(e){var r,t,o,n=e.exports={};function i(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{t="function"==typeof clearTimeout?clearTimeout:a}catch(e){t=a}}();var l=[],c=!1,d=-1;function u(){c&&o&&(c=!1,o.length?l=o.concat(l):d=-1,l.length&&m())}function m(){if(!c){var e=s(u);c=!0;for(var r=l.length;r;){for(o=l,l=[];++d<r;)o&&o[d].run();d=-1,r=l.length}o=null,c=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===a||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(r){try{return t.call(null,e)}catch(r){return t.call(this,e)}}}(e)}}function f(e,r){this.fun=e,this.array=r}function g(){}n.nextTick=function(e){var r=Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];l.push(new f(e,r)),1!==l.length||c||s(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},t={};function o(e){var n=t[e];if(void 0!==n)return n.exports;var i=t[e]={exports:{}},a=!0;try{r[e](i,i.exports,o),a=!1}finally{a&&delete t[e]}return i.exports}o.ab="//";var n=o(229);e.exports=n}()}},function(e){e.O(0,[9064,2971,2117,1744],function(){return e(e.s=2575)}),_N_E=e.O()}]);