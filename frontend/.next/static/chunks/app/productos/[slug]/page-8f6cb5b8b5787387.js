(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3553],{6018:function(e,t,r){Promise.resolve().then(r.bind(r,2454))},2454:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var s=r(7437),a=r(2265),o=r(4523),n=r(9064),c=r(7648);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),u=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},d=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},m=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var h={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let p=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:n,className:c="",children:l,iconNode:i,...u}=e;return(0,a.createElement)("svg",{ref:t,...h,width:s,height:s,stroke:r,strokeWidth:n?24*Number(o)/Number(s):o,className:d("lucide",c),...!l&&!m(u)&&{"aria-hidden":"true"},...u},[...i.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(l)?l:[l]])}),g=((e,t)=>{let r=(0,a.forwardRef)((r,s)=>{let{className:o,...n}=r;return(0,a.createElement)(p,{ref:s,iconNode:t,className:d("lucide-".concat(l(u(e))),"lucide-".concat(e),o),...n})});return r.displayName=u(e),r})("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function f(e){let{params:t}=e,[r,l]=a.useState(""),[i,u]=(0,a.useState)(null),{addToCart:d,loading:m}=(0,o.u)(),[h,p]=(0,a.useState)(!0),[f,x]=(0,a.useState)(null),[y,b]=(0,a.useState)(!1),[v,w]=(0,a.useState)(1),j=async()=>{if(!y&&i){b(!0);try{await d(i,v),n.ZP.success("".concat(i.nombre," agregado al carrito"))}catch(e){n.ZP.error("Error: ".concat(e.message||"No se pudo agregar al carrito"))}finally{b(!1)}}};return((0,a.useEffect)(()=>{(async()=>{l((await t).slug)})()},[t]),(0,a.useEffect)(()=>{r&&(async()=>{try{let e="https://e-comerce-floreria-production.up.railway.app/api/catalogo/productos/".concat(r,"/");console.log("\uD83D\uDD0D Fetching product from:",e),console.log("\uD83D\uDCDD Slug:",r);let t=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"omit"});if(console.log("\uD83D\uDCCA Response status:",t.status,t.statusText),!t.ok){let e=await t.text();throw console.error("❌ Error response:",e),Error("Producto no encontrado (".concat(t.status,")"))}let s=await t.json();console.log("✅ Product loaded:",s.nombre),u(s)}catch(e){console.error("\uD83D\uDCA5 Error completo:",e),x(e.message||"Error al cargar el producto")}finally{p(!1)}})()},[r]),h)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-700"})}):f?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Error"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:f}),(0,s.jsx)(c.default,{href:"/productos",className:"text-green-700 hover:underline",children:"Volver a productos"})]})}):i?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)(c.default,{href:"/productos",className:"inline-flex items-center gap-2 text-gray-600 hover:text-green-700 mb-8 transition-colors",children:[(0,s.jsx)(g,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"font-medium",children:"Volver a productos"})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-12 lg:gap-16",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("div",{className:"sticky top-8",children:[(0,s.jsx)("div",{className:"aspect-square bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl overflow-hidden shadow-xl",children:(0,s.jsx)("img",{src:(e=>{let t="/images/no-image.jpg";return e&&"null"!==e&&"undefined"!==e?e.startsWith("/media/")?"http://localhost".concat(e):e.includes("web:8000")?e.replace("web:8000","localhost"):e.startsWith("http://")||e.startsWith("https://")?e:t:t})(i.imagen_principal),alt:i.nombre,className:"w-full h-full object-cover",onError:e=>{let t=e.target;t.src="/images/no-image.jpg",t.classList.add("p-8","object-contain")}})}),i.envio_gratis&&(0,s.jsx)("div",{className:"absolute top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg",children:"Env\xedo gratis"})]})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h1",{className:"text-4xl lg:text-5xl font-serif text-gray-900 mb-4 leading-tight",children:i.nombre}),i.descripcion_corta&&(0,s.jsx)("p",{className:"text-lg text-gray-600 mb-6 italic border-l-4 border-green-600 pl-4",children:i.descripcion_corta}),(0,s.jsx)("div",{className:"mb-8",children:i.precio_descuento?(0,s.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,s.jsxs)("span",{className:"text-4xl font-bold text-green-700",children:["$ ",parseFloat(i.precio_descuento).toLocaleString()]}),(0,s.jsxs)("span",{className:"text-2xl text-gray-400 line-through",children:["$ ",parseFloat(i.precio).toLocaleString()]}),(0,s.jsxs)("span",{className:"bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-semibold",children:[Math.round((1-parseFloat(i.precio_descuento)/parseFloat(i.precio))*100),"% OFF"]})]}):(0,s.jsxs)("span",{className:"text-4xl font-bold text-gray-900",children:["$ ",parseFloat(i.precio).toLocaleString()]})}),i.descripcion&&(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Descripci\xf3n:"}),(0,s.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:(0,s.jsx)("p",{className:"text-gray-700 whitespace-pre-line leading-relaxed",children:i.descripcion})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Cantidad:"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>w(Math.max(1,v-1)),className:"w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-green-600 hover:text-green-600 transition-colors font-semibold",disabled:v<=1,children:"-"}),(0,s.jsx)("span",{className:"text-xl font-semibold w-12 text-center",children:v}),(0,s.jsx)("button",{onClick:()=>w(Math.min(i.stock,v+1)),className:"w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-green-600 hover:text-green-600 transition-colors font-semibold",disabled:v>=i.stock,children:"+"}),(0,s.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",i.stock," disponibles)"]})]})]}),(0,s.jsx)("button",{onClick:j,disabled:y||i.stock<=0,className:"w-full bg-green-700 hover:bg-green-800 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-4 px-8 rounded-xl transition-all duration-300 text-lg shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98]",children:y?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Agregando..."]}):i.stock<=0?"Sin stock":"Agregar al carrito"}),(0,s.jsxs)("div",{className:"mt-8 space-y-3",children:[i.tipo_flor&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF38"}),(0,s.jsxs)("span",{children:["Tipo: ",(0,s.jsx)("strong",{children:i.tipo_flor.nombre})]})]}),i.ocasiones&&i.ocasiones.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF89"}),(0,s.jsxs)("span",{children:["Ocasiones: ",(0,s.jsx)("strong",{children:i.ocasiones.map(e=>e.nombre).join(", ")})]})]})]})]})]})]})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Producto no encontrado"}),(0,s.jsx)(c.default,{href:"/productos",className:"text-green-700 hover:underline",children:"Volver a productos"})]})})}},4523:function(e,t,r){"use strict";r.d(t,{CartProviderRobust:function(){return i},u:function(){return u}});var s=r(7437),a=r(2265),o=r(9064);let n={baseUrl:r(257).env.NEXT_PUBLIC_API_URL||"https://e-comerce-floreria-production.up.railway.app/api",timeout:1e4,retryAttempts:3,retryDelay:1e3};class c{static getInstance(){return c.instance||(c.instance=new c),c.instance}async delay(e){return new Promise(t=>setTimeout(t,e))}generateRequestKey(e,t){return"".concat(e,"-").concat(JSON.stringify(t))}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;if(r.startsWith("http://")||r.startsWith("https://"));else if(r.startsWith("/api/"))r="".concat(n.baseUrl).concat(r.replace("/api",""));else{let e=r.replace(/^\/+/,"");r="".concat(n.baseUrl,"/").concat(e)}let s=r,a=this.generateRequestKey(s,t);if(this.requestQueue.has(a))return console.log("\uD83D\uDD04 Reusing existing request for ".concat(e)),this.requestQueue.get(a);let o=this.executeRequest(s,t);this.requestQueue.set(a,o);try{return await o}finally{this.requestQueue.delete(a)}}async executeRequest(e,t){let r;for(let s=1;s<=n.retryAttempts;s++){let a=new AbortController,o=setTimeout(()=>{console.log("⏰ Request timeout after ".concat(n.timeout,"ms")),a.abort()},n.timeout);try{console.log("\uD83C\uDF10 API Request (attempt ".concat(s,"): ").concat(e));let r=(t.method||"GET").toUpperCase(),n={Accept:"application/json"};"GET"===r||t.headers&&"Content-Type"in t.headers||(n["Content-Type"]="application/json");let c={...t,method:r,signal:a.signal,credentials:"include",headers:{...n,...t.headers||{}}},l=await fetch(e,c);if(clearTimeout(o),console.log("\uD83D\uDCE1 Response received: ".concat(l.status," ").concat(l.statusText)),!l.ok){let e="HTTP error! status: ".concat(l.status),t=l.clone();try{let t=await l.json();t&&"object"==typeof t&&(e=t.message||t.error||JSON.stringify(t))}catch(r){try{let r=await t.text();r&&(e=r)}catch(e){}}let r=Error(e);throw r.status=l.status,r}try{let t=await l.json();return console.log("✅ API Success: ".concat(e),t),t}catch(e){throw console.error("❌ Error parsing JSON response:",e),Error("Invalid JSON response from server")}}catch(t){if(r=t,console.error("❌ API Error (attempt ".concat(s,"): ").concat(e),t.message),("AbortError"===t.name||t.message.includes("fetch"))&&console.log("\uD83D\uDD04 Network/timeout error, will retry..."),s<n.retryAttempts){let e=n.retryDelay*s;console.log("⏳ Retrying in ".concat(e,"ms...")),await this.delay(e)}}}throw r||Error("All retry attempts failed")}constructor(){this.requestQueue=new Map}}let l=(0,a.createContext)(void 0),i=e=>{let{children:t}=e,r=()=>{try{let e=localStorage.getItem("cart_data");if(e){let t=JSON.parse(e);return console.log("✅ Carrito cargado desde localStorage:",t),t}}catch(e){console.error("❌ Error cargando carrito:",e)}return{items:[],total_price:0,total_items:0,is_empty:!0}},[n,i]=(0,a.useState)(()=>r()),[u,d]=(0,a.useState)(!1),[m,h]=(0,a.useState)(null),p=(0,a.useRef)(c.getInstance()),g=(0,a.useRef)(!0);(0,a.useRef)(0);let f=(0,a.useRef)(!1),x=(0,a.useCallback)(e=>{if(g.current){console.log("\uD83D\uDD04 Updating cart state:",e),i(e),h(null);try{localStorage.setItem("cart_data",JSON.stringify(e)),sessionStorage.setItem("cart_data",JSON.stringify(e)),console.log("\uD83D\uDCBE Carrito guardado en localStorage y sessionStorage")}catch(e){console.error("❌ Error guardando carrito:",e)}}},[]),y=(0,a.useCallback)(e=>{g.current&&d(e)},[]),b=(0,a.useCallback)(e=>{g.current&&h(e)},[]),v=(0,a.useCallback)(async()=>{if(f.current){console.log("\uD83D\uDD04 RefreshCart already in progress, skipping...");return}f.current=!0;try{y(!0),b(null),console.log("\uD83D\uDD04 Starting robust cart refresh...");let e=Date.now(),t=await p.current.request("/carrito/simple/?t=".concat(e),{method:"GET"});if(t&&"object"==typeof t){let e={items:Array.isArray(t.items)?t.items:[],total_price:parseFloat(t.total_price)||0,total_items:parseInt(t.total_items)||0,is_empty:!!t.is_empty};x(e),console.log("✅ Cart refreshed successfully:",e)}else throw Error("Invalid data structure received from server")}catch(e){console.error("❌ Cart refresh failed:",e),b("Connection failed: ".concat(e.message)),x({items:[],total_price:0,total_items:0,is_empty:!0})}finally{y(!1),f.current=!1}},[x,y,b]),w=(0,a.useCallback)(async()=>{console.log("\uD83D\uDD04 Retrying connection..."),await v()},[v]),j=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{y(!0),console.log("\uD83D\uDED2 Adding to cart:",{product:e.nombre,quantity:t});let r=await p.current.request("/carrito/simple/add/",{method:"POST",body:JSON.stringify({product_id:e.id,quantity:t})});(null==r?void 0:r.cart)?(x(r.cart),o.ZP.success("".concat(e.nombre," agregado al carrito"))):await v()}catch(e){console.error("❌ Add to cart failed:",e),o.ZP.error(e.message||"Error al agregar producto"),b(e.message)}finally{y(!1)}},[v,x,y,b]),D=(0,a.useCallback)(async e=>{try{y(!0),console.log("\uD83D\uDDD1️ Removing from cart:",e),await p.current.request("/carrito/remove/",{method:"DELETE",body:JSON.stringify({product_id:e})}),await v(),o.ZP.success("Producto eliminado del carrito")}catch(e){console.error("❌ Remove from cart failed:",e),o.ZP.error(e.message||"Error al eliminar producto"),b(e.message)}finally{y(!1)}},[v,y,b]),N=(0,a.useCallback)(async(e,t)=>{try{y(!0),console.log("\uD83D\uDCDD Updating quantity:",{productId:e,newQuantity:t}),await p.current.request("/carrito/update/",{method:"PUT",body:JSON.stringify({product_id:e,quantity:t})}),await v(),o.ZP.success("Cantidad actualizada")}catch(e){console.error("❌ Update quantity failed:",e),o.ZP.error(e.message||"Error al actualizar cantidad"),b(e.message)}finally{y(!1)}},[v,y,b]),C=(0,a.useCallback)(async()=>{try{y(!0),console.log("\uD83E\uDDF9 Clearing cart..."),await p.current.request("/carrito/clear/",{method:"DELETE"}),x({items:[],total_price:0,total_items:0,is_empty:!0}),o.ZP.success("Carrito limpiado")}catch(e){console.error("❌ Clear cart failed:",e),o.ZP.error(e.message||"Error al limpiar carrito"),b(e.message)}finally{y(!1)}},[x,y,b]);return(0,a.useEffect)(()=>(console.log("\uD83D\uDE80 CartProviderRobust mounted, starting initial load..."),v(),()=>{g.current=!1}),[]),(0,s.jsx)(l.Provider,{value:{cart:n,loading:u,error:m,addToCart:j,removeFromCart:D,updateQuantity:N,clearCart:C,refreshCart:v,retryConnection:w},children:t})},u=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useCartRobust must be used within a CartProviderRobust");return e}},257:function(e,t,r){"use strict";var s,a;e.exports=(null==(s=r.g.process)?void 0:s.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,s,a=e.exports={};function o(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{r="function"==typeof clearTimeout?clearTimeout:n}catch(e){r=n}}();var l=[],i=!1,u=-1;function d(){i&&s&&(i=!1,s.length?l=s.concat(l):u=-1,l.length&&m())}function m(){if(!i){var e=c(d);i=!0;for(var t=l.length;t;){for(s=l,l=[];++u<t;)s&&s[u].run();u=-1,t=l.length}s=null,i=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===n||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new h(e,t)),1!==l.length||i||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=p,a.addListener=p,a.once=p,a.off=p,a.removeListener=p,a.removeAllListeners=p,a.emit=p,a.prependListener=p,a.prependOnceListener=p,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function s(e){var a=r[e];if(void 0!==a)return a.exports;var o=r[e]={exports:{}},n=!0;try{t[e](o,o.exports,s),n=!1}finally{n&&delete r[e]}return o.exports}s.ab="//";var a=s(229);e.exports=a}()}},function(e){e.O(0,[9064,7648,2971,2117,1744],function(){return e(e.s=6018)}),_N_E=e.O()}]);