(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5836],{5836:function(e,o,r){"use strict";r.r(o),r.d(o,{default:function(){return c}});var s=r(7437),a=r(2265),t=r(9376);function l(e){let{product:o}=e,r=(0,t.useRouter)(),l=(0,a.useMemo)(()=>{let e="/images/no-image.jpg";try{let r=o.imagen_principal;if(!r||"null"===r||"undefined"===r)return console.log("Sin imagen para producto:",o.nombre),e;if(r.startsWith("/media/")){let e="http://localhost".concat(r);return console.log("✅ Imagen del backend:",o.nombre,e),e}if(r.includes("web:8000")){let e=r.replace("web:8000","localhost");return console.log("✅ URL Docker corregida:",e),e}if((r.startsWith("http://")||r.startsWith("https://"))&&!r.includes("placeholder.com"))return r;return e}catch(o){return console.error("Error procesando URL de imagen:",o),e}},[o.imagen_principal,o.nombre]),n=o.id.toString();return(0,s.jsx)("div",{onClick:()=>{console.log("\uD83D\uDD17 Click en ProductCard, navegando a:","/productos/".concat(n)),r.push("/productos/".concat(n))},className:"block cursor-pointer",children:(0,s.jsxs)("div",{className:"group bg-white rounded-xl shadow-sm hover:shadow-2xl transition-all duration-500 overflow-hidden border border-gray-100 hover:border-gray-200 transform hover:-translate-y-2 cursor-pointer",children:[(0,s.jsxs)("div",{className:"relative aspect-square bg-gradient-to-br from-gray-50 to-gray-100 overflow-hidden",children:[o.envio_gratis&&(0,s.jsx)("div",{className:"absolute top-3 right-3 bg-green-600 text-white text-xs px-3 py-1.5 rounded-full font-semibold z-10 shadow-md",children:"Env\xedo gratis"}),(0,s.jsx)("img",{src:l,alt:o.nombre||"Producto",className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110",onError:e=>{let r=e.target;console.log("Error cargando imagen, usando fallback para:",o.nombre),r.src="/images/no-image.jpg",r.classList.add("p-4","object-contain")},loading:"lazy"},"product-".concat(o.id,"-img")),(0,s.jsx)("div",{className:"absolute inset-0 bg-black opacity-0 group-hover:opacity-5 transition-opacity duration-500"})]}),(0,s.jsxs)("div",{className:"p-5",children:[(0,s.jsx)("h3",{className:"font-serif text-gray-900 text-base mb-3 line-clamp-2 min-h-[3rem] leading-relaxed tracking-wide",children:o.nombre}),o.descripcion_corta&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:o.descripcion_corta}),(0,s.jsx)("div",{className:"flex items-baseline justify-between mb-4",children:o.precio_descuento?(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsxs)("span",{className:"text-xl font-bold text-green-700",children:["$ ",parseFloat(o.precio_descuento).toLocaleString()]}),(0,s.jsxs)("span",{className:"text-sm text-gray-400 line-through",children:["$ ",parseFloat(o.precio).toLocaleString()]})]}):(0,s.jsxs)("span",{className:"text-xl font-bold text-gray-900",children:["$ ",parseFloat(o.precio).toLocaleString()]})}),(0,s.jsx)("div",{className:"w-full bg-green-700 hover:bg-green-800 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 text-sm shadow-sm hover:shadow-md text-center",children:"Ver detalles"})]})]})})}r(8569);var n=e=>{let{onFiltersChange:o,className:r=""}=e,[t,l]=(0,a.useState)([]),[n,i]=(0,a.useState)([]),[c,d]=(0,a.useState)({}),[u,m]=(0,a.useState)(!0);console.log("\uD83D\uDD25 ProductFilters RENDERIZADO!",{loading:u,tiposFlor:t.length,ocasiones:n.length}),(0,a.useEffect)(()=>{(async()=>{try{console.log("\uD83D\uDD0D Loading filter data..."),await new Promise(e=>setTimeout(e,500));let e=[{id:1,nombre:"Rosas"},{id:2,nombre:"Tulipanes"},{id:3,nombre:"Girasoles"},{id:4,nombre:"Orqu\xeddeas"},{id:5,nombre:"Mixto"},{id:6,nombre:"Lilium"},{id:7,nombre:"Gerberas"}],o=[{id:1,nombre:"Amor"},{id:2,nombre:"San Valent\xedn"},{id:3,nombre:"Aniversario"},{id:4,nombre:"Cumplea\xf1os"},{id:5,nombre:"Felicitaciones"},{id:6,nombre:"Graduaci\xf3n"},{id:7,nombre:"Amistad"},{id:8,nombre:"Alegr\xeda"},{id:9,nombre:"Boda"},{id:10,nombre:"Elegancia"},{id:11,nombre:"Pureza"},{id:12,nombre:"Decoraci\xf3n"},{id:13,nombre:"Lujo"}];console.log("\uD83C\uDF38 Mock tipos de flor loaded:",e.length),console.log("\uD83C\uDF89 Mock ocasiones loaded:",o.length),l(e),i(o)}catch(e){console.error("\uD83D\uDCA5 Error loading filter data:",e)}})()},[]),(0,a.useEffect)(()=>{o(c)},[c,o]);let p=(e,o)=>{d(r=>({...r,[e]:""===o?void 0:o}))},g=Object.keys(c).some(e=>void 0!==c[e]);return(0,s.jsxs)("div",{className:"product-filters ".concat(r),children:[(0,s.jsxs)("div",{className:"filters-header",children:[(0,s.jsx)("h3",{children:"\uD83D\uDD0D Filtros de Productos"}),g&&(0,s.jsx)("button",{onClick:()=>{d({})},className:"clear-filters-btn",children:"\uD83D\uDDD1️ Limpiar filtros"})]}),u?(0,s.jsx)("div",{className:"loading-state",children:(0,s.jsx)("p",{children:"Cargando filtros..."})}):(0,s.jsxs)("div",{className:"filters-content",children:[(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsx)("label",{className:"filter-label",children:"\uD83C\uDF38 Tipo de Flor"}),(0,s.jsxs)("select",{value:c.tipo_flor||"",onChange:e=>p("tipo_flor",e.target.value?parseInt(e.target.value):void 0),className:"filter-select","aria-label":"Seleccionar tipo de flor",children:[(0,s.jsx)("option",{value:"",children:"Todos los tipos"}),t.map(e=>(0,s.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]}),(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsx)("label",{className:"filter-label",children:"\uD83C\uDF89 Ocasi\xf3n"}),(0,s.jsxs)("select",{value:c.ocasion||"",onChange:e=>p("ocasion",e.target.value?parseInt(e.target.value):void 0),className:"filter-select","aria-label":"Seleccionar ocasi\xf3n",children:[(0,s.jsx)("option",{value:"",children:"Todas las ocasiones"}),n.map(e=>(0,s.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]}),(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsx)("label",{className:"filter-label",children:"\uD83D\uDCB0 Precio"}),(0,s.jsxs)("div",{className:"price-range",children:[(0,s.jsx)("input",{type:"number",placeholder:"M\xedn",value:c.precio_min||"",onChange:e=>p("precio_min",e.target.value?parseFloat(e.target.value):void 0),className:"price-input"}),(0,s.jsx)("span",{children:"-"}),(0,s.jsx)("input",{type:"number",placeholder:"M\xe1x",value:c.precio_max||"",onChange:e=>p("precio_max",e.target.value?parseFloat(e.target.value):void 0),className:"price-input"})]})]}),(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsx)("label",{className:"filter-label",children:"\uD83D\uDCCA Ordenar por"}),(0,s.jsxs)("select",{value:c.ordering||"",onChange:e=>p("ordering",e.target.value||void 0),className:"filter-select","aria-label":"Seleccionar orden de productos",children:[(0,s.jsx)("option",{value:"",children:"M\xe1s recientes"}),(0,s.jsx)("option",{value:"nombre",children:"Nombre A-Z"}),(0,s.jsx)("option",{value:"-nombre",children:"Nombre Z-A"}),(0,s.jsx)("option",{value:"precio",children:"Precio menor"}),(0,s.jsx)("option",{value:"-precio",children:"Precio mayor"})]})]}),(0,s.jsx)("div",{className:"filter-group",children:(0,s.jsxs)("label",{className:"filter-checkbox",children:[(0,s.jsx)("input",{type:"checkbox",checked:c.destacados||!1,onChange:e=>p("destacados",e.target.checked||void 0)}),"⭐ Solo destacados"]})}),(0,s.jsx)("div",{className:"filter-group",children:(0,s.jsxs)("label",{className:"filter-checkbox",children:[(0,s.jsx)("input",{type:"checkbox",checked:c.adicionales||!1,onChange:e=>p("adicionales",e.target.checked||void 0)}),"\uD83C\uDF81 Solo adicionales"]})})]})]})},i=r(257);function c(e){let{showRecommended:o=!1,showAdditionals:r=!1,showFilters:c}=e,[d,u]=(0,a.useState)([]),[m,p]=(0,a.useState)([]),[g,h]=(0,a.useState)(!0),[D,x]=(0,a.useState)(null),[b,f]=(0,a.useState)([]),v=(0,t.useSearchParams)();(0,a.useEffect)(()=>{(async()=>{try{var e;h(!0),x(null);let o=Date.now(),r=i.env.NEXT_PUBLIC_BACKEND_URL||"https://e-comerce-floreria-production.up.railway.app",s=new URLSearchParams(window.location.search),a=new URLSearchParams;a.set("t",o.toString());let t=s.get("tipo_flor"),l=s.get("ocasion");t&&a.set("tipo_flor",t),l&&a.set("ocasion",l);let n="".concat(r,"/api/catalogo/productos/?").concat(a.toString());console.log("\uD83D\uDD0D Iniciando solicitud a:",n),console.log("\uD83C\uDFAF Filtros aplicados:",{tipo_flor:t,ocasion:l});let c=await fetch(n,{credentials:"omit",headers:{Accept:"application/json","Cache-Control":"no-cache, no-store",Pragma:"no-cache"},cache:"no-store"});if(console.log("\uD83D\uDCCA Respuesta recibida:",c.status,c.statusText),!c.ok){let e=c.clone(),o=await e.text();throw console.error("❌ Error en la respuesta:",c.status,o),Error("Error ".concat(c.status,": ").concat(c.statusText," - ").concat(o))}let d=await c.json();if(console.log("\uD83D\uDCE6 Datos recibidos de la API:",d),console.log("\uD83D\uDCCA Cantidad de productos:",Array.isArray(d)?d.length:"No es array"),console.log("\uD83D\uDD22 IDs de productos:",Array.isArray(d)?d.map(e=>e.id):"N/A"),!Array.isArray(d))throw console.error("❌ La respuesta no es un array:",d),Error("Formato de respuesta inesperado: se esperaba un array de productos");console.log("✅ ".concat(d.length," productos cargados correctamente")),console.log("\uD83D\uDCF8 Primera imagen:",null===(e=d[0])||void 0===e?void 0:e.imagen_principal),u(d),p(d),f(d)}catch(e){console.error("❌ Error cargando productos:",e.message),console.error("Error completo:",e),x("Error al cargar productos: ".concat(e.message,". Por favor, verifica que el servidor est\xe9 funcionando.")),u([]),p([]),f([])}finally{h(!1)}})()},[v]),(0,a.useEffect)(()=>{if(0===d.length)return;let e=new URLSearchParams(window.location.search),o=e.get("tipo_flor"),r=e.get("ocasion");console.log("\uD83C\uDFAF ProductListClient con",d.length,"productos"),console.log("\uD83D\uDD0D Params URL - tipo_flor:",o,"ocasion:",r),console.log("\uD83D\uDCE6 Primer producto estructura:",d[0]);let s=[...d];if(o){let e=parseInt(o);console.log("\uD83D\uDD0D Buscando tipo_flor ID:",e),s=s.filter(o=>{var r;let s=(null===(r=o.tipo_flor)||void 0===r?void 0:r.id)===e;return console.log("  - ".concat(o.nombre,": tipo_flor=").concat(JSON.stringify(o.tipo_flor),", match=").concat(s)),s}),console.log("\uD83C\uDF38 Filtrado por tipo_flor ID ".concat(e,":"),s.length,"de",d.length,"productos")}if(r){let e=parseInt(r);console.log("\uD83D\uDD0D Buscando ocasi\xf3n ID:",e),s=s.filter(o=>{let r=Array.isArray(o.ocasiones)&&o.ocasiones.some(o=>o.id===e);return console.log("  - ".concat(o.nombre,": ocasiones=").concat(JSON.stringify(o.ocasiones),", match=").concat(r)),r}),console.log("\uD83C\uDF89 Filtrado por ocasi\xf3n ID ".concat(e,":"),s.length,"de",d.length,"productos")}console.log("\uD83D\uDCBE ACTUALIZANDO displayProducts a:",s.length,"productos"),f(s),p(s)},[d]),(0,a.useEffect)(()=>{if(console.log("\uD83C\uDF10 URL completa:",window.location.href),console.log("\uD83D\uDCCB SearchParams toString:",v.toString()),0===d.length){console.log("⏸️ No hay productos a\xfan, esperando...");return}let e=v.get("tipo_flor"),o=v.get("ocasion");console.log("\uD83D\uDD04 URL CAMBI\xd3 - Re-filtrando..."),console.log("\uD83D\uDD0D Nuevos params - tipo_flor:",e,"ocasion:",o);let r=[...d];if(e){let o=parseInt(e);console.log("\uD83D\uDD0D Buscando tipo_flor ID:",o),r=r.filter(e=>{var r;return(null===(r=e.tipo_flor)||void 0===r?void 0:r.id)===o}),console.log("\uD83C\uDF38 Filtrado por tipo_flor ID ".concat(o,":"),r.length,"de",d.length,"productos")}if(o){let e=parseInt(o);console.log("\uD83D\uDD0D Buscando ocasi\xf3n ID:",e),r=r.filter(o=>Array.isArray(o.ocasiones)&&o.ocasiones.some(o=>o.id===e)),console.log("\uD83C\uDF89 Filtrado por ocasi\xf3n ID ".concat(e,":"),r.length,"de",d.length,"productos")}console.log("\uD83D\uDCBE ACTUALIZANDO displayProducts a:",r.length,"productos"),f(r),p(r)},[v,d]);let j=e=>{console.log("\uD83D\uDD04 Aplicando filtros:",e);let o=[...d],r=[{id:1,nombre:"Rosas"},{id:2,nombre:"Tulipanes"},{id:3,nombre:"Girasoles"},{id:4,nombre:"Gerberas"},{id:5,nombre:"Mixto"},{id:6,nombre:"Orqu\xeddeas"}],s=[{id:1,nombre:"Amor"},{id:2,nombre:"Cumplea\xf1os"},{id:3,nombre:"Amistad"},{id:4,nombre:"Aniversario"},{id:5,nombre:"Agradecimiento"}];if(e.tipo_flor&&e.tipo_flor.length>0){let s=e.tipo_flor.map(e=>{let o=r.find(o=>o.id===e);return o?o.nombre:""}).filter(Boolean);console.log("\uD83C\uDF38 Filtrando por tipos de flor:",s),o=o.filter(e=>{var o;return s.includes(null===(o=e.tipo_flor)||void 0===o?void 0:o.nombre)})}if(e.ocasion&&e.ocasion.length>0){let r=e.ocasion.map(e=>{let o=s.find(o=>o.id===e);return o?o.nombre:""}).filter(Boolean);console.log("\uD83C\uDF89 Filtrando por ocasiones:",r),o=o.filter(e=>{var o;return null===(o=e.ocasiones)||void 0===o?void 0:o.some(e=>r.includes(e.nombre))})}if(void 0!==e.precio_min&&null!==e.precio_min&&(console.log("\uD83D\uDCB0 Filtrando precio m\xednimo:",e.precio_min),o=o.filter(o=>parseFloat(o.precio_descuento||o.precio)>=e.precio_min)),void 0!==e.precio_max&&null!==e.precio_max&&(console.log("\uD83D\uDCB0 Filtrando precio m\xe1ximo:",e.precio_max),o=o.filter(o=>parseFloat(o.precio_descuento||o.precio)<=e.precio_max)),e.destacados&&(console.log("⭐ Filtrando solo destacados"),o=o.filter(e=>e.is_featured)),e.ordering)switch(console.log("\uD83D\uDCCA Ordenando por:",e.ordering),e.ordering){case"precio_asc":o.sort((e,o)=>parseFloat(e.precio_descuento||e.precio)-parseFloat(o.precio_descuento||o.precio));break;case"precio_desc":o.sort((e,o)=>{let r=parseFloat(e.precio_descuento||e.precio);return parseFloat(o.precio_descuento||o.precio)-r});break;case"nombre_asc":o.sort((e,o)=>e.nombre.localeCompare(o.nombre));break;case"nombre_desc":o.sort((e,o)=>o.nombre.localeCompare(e.nombre))}console.log("✅ Productos despu\xe9s de filtros:",o.length),p(o),f(o)};if(g)return(0,s.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-700"})});if(D){let e=D.includes("MODO SIN CONEXI\xd3N");return(0,s.jsx)("div",{className:"text-center py-6 mb-4",children:(0,s.jsx)("div",{className:"".concat(e?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200"," border rounded-lg p-6 max-w-2xl mx-auto shadow-sm"),children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsx)("span",{className:"text-2xl mr-2",children:"⚠️"}),(0,s.jsx)("h3",{className:"text-amber-800 font-semibold",children:"Modo Sin Conexi\xf3n"})]}),(0,s.jsx)("p",{className:"text-amber-700 mb-2",children:"No se pudo establecer conexi\xf3n con el servidor."}),(0,s.jsx)("p",{className:"text-amber-600",children:"Mostrando productos de demostraci\xf3n sin precios ni im\xe1genes reales."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"text-red-800 font-semibold mb-2",children:"Error al cargar productos"}),(0,s.jsx)("p",{className:"text-red-600",children:D})]})})})}return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF38"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:o?"Productos Recomendados":r?"Productos Adicionales":"Cat\xe1logo de Productos"})]}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Mostrando ",b.length," de ",d.length," productos disponibles"]})]}),(void 0!==c?c:!o&&!r)&&(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(n,{onFiltersChange:j})}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 mt-8 px-2",children:b.map(e=>(0,s.jsx)(l,{product:e},e.id))}),0===b.length&&(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 max-w-md mx-auto",children:[(0,s.jsx)("h3",{className:"text-gray-800 font-semibold mb-2",children:"No se encontraron productos"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Intenta ajustar los filtros para ver m\xe1s resultados"}),(0,s.jsx)("button",{onClick:()=>j({}),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Limpiar Filtros"})]})})]})}},9376:function(e,o,r){"use strict";var s=r(5475);r.o(s,"useParams")&&r.d(o,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(o,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(o,{useSearchParams:function(){return s.useSearchParams}})},8569:function(){}}]);